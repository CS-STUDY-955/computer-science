# 운영체제상의 문제들
## 식사하는 철학자 문제
### 개요
![An_illustration_of_the_dining_philosophers_problem](https://user-images.githubusercontent.com/63623597/229533009-ccfb019b-3f1a-4264-93cf-ef7cb0d9264f.png)
- 운영체제의 교착상태를 설명하기 위한 문제로, 1965년 다익스트라가 고안
- 다섯 명의 철학자가 원형 테이블에 둘러앉아 식사와 사색을 반복하는 상황을 가정하고, 이하의 순서로 행동한다고 하자
  1. 철학자는 자신의 왼쪽 식기를 집어든다. 다른 철학자가 이미 쓰고 있으면, 내려놓을 때까지 사색에 잠기며 대기한다.
  2. 왼쪽을 든 후엔 오른쪽 식기를 집어든다. 들 수 없다면 1번과 마찬가지로 대기한다.
  3. 두 식기를 모두 든 후엔 일정시간동안 식사를 한다
  4. 식사가 끝났다면 두 식기를 내려놓는다
  5. 다시 배가 고파지면 다시 1번으로 돌아간다

### 문제
- 위와 같은 상황에서, 만약 5명의 철학자들이 동시에 식사를 하려고 하면, 모든 철학자들이 식기 하나씩만 든체로 무한정 대기하게 된다.
- 또한 이런 대기 상태가 지속되면 철학자들은 결국 굶어죽고 말 것이다

### 설명
- 위 문제는 교착상태의 전형적인 예제로, 교착상태의 4가지 조건을 모두 만족한다. 
1. 상호배타(Mutual Exclusion): 자원은 한 번에 하나의 프로세스에게만 할당될 수 있다.
2. 보유 및 대기(Hold and Wait): 프로세스가 어떤 자원을 가지고 있으면서, 다른 프로세스가 사용중인 또다른 자원을 대기한다
3. 비선점(No preemption): 다른 프로세스가 사용 중인 자원을 강제로 뺏을 수 없다.
4. 환형 대기(Circular Wait): 2번의 상황이 꼬리를 물어 마지막 프로세스가 첫 프로세스가 점유중인 자원을 대기하는 상태

### 해결
- 다양한 해결방법이 존재하지만, 여기선 교착상태의 4가지 조건을 중심으로 서술한다
1. 자원을 공유하게 하여 상호배타를 깬다
     - 보통은 원칙적으로 불가능하다
2. 필요한 자원이 이미 다른 곳에 할당되었을 때, 대기하지 말고 보유하고 있던 자원도 포기하게 하여 대기상태를 발생시키지 않는다.
     - 자원 활용률이 떨어지고, 기아현상(starvation)이 발생한다
3. 이미 할당중인 자원을 강제로 뺏을 수 있게 한다.
     - 이 역시 보통은 원칙적으로 불가능하다
4. 환형 대기를 깨트리도록 규칙을 바꾼다
     - 홀수번호 철학자는 오른쪽 식기를 먼저, 짝수번호 철학자는 왼쪽 식기를 먼저 들게 한다.
     - 마지막 철학자만 반대 식기를 먼저 들게 한다.
     - 자원 활용률이 저하될 수 있다.

## 잠자는 이발사 문제
### 개요
- 운영체제의 프로세스 간 통신과 그들간의 동기화 문제를 다루는 문제로, 역시 다익스트라가 만들었다고 한다.
- 이발사가 손님이 있을 때는 일하고 없을 때는 쉬는 상황을 가정한다.
- 손님은 이발소에 들어와서 다른 손님이 없으면 쉬고있는 이발사를 깨운다. 다른 손님이 있다면 대기실에 빈 의자가 있으면 앉고 없으면 떠난다.
- 이발사는 한명의 머리를 다 깎은 뒤엔 다음 손님이 있는지 확인하기 위해 대기실에 가서 확인한다. 다른 손님이 있으면 그 손님의 머리를 깎고 없으면 다시 가서 잔다.

### 문제
- 문제는, 이발사와 손님들의 시간이 분명하지 않다는 것이다
- 이런 상황을 가정해볼 수 있다.
  1. 손님은 이발사가 다른 손님의 머릴 깎고 있는걸 확인하고 대기실로 이동한다.
  2. 손님이 아직 대기실에 도착하지 않았는데, 이발사는 현재 손님의 머리를 다 깎고 대기실을 확인하러 간다.
  3. 대기실엔 아직 손님이 없으니 이발사는 자러가고, 손님은 하염없이 이발사를 기다린다.
- 또는 이런 상황도 가정할 수 있다.
  1. 대기실에 의자가 하나밖에 없는 상황에서 두 손님이 동시에 도착했다.
  2. 두 손님 모두 현재 이발사가 먼저 온 손님의 머리를 깎고 있는걸 확인하고 대기실로 이동한다.
  3. 하지만 의자는 하나뿐이니 두 손님은 하나의 의자를 두고 싸우게된다.

### 해결
- 이 역시 수많은 해결 방법이 존재하므로 이하의 해결방법은 일부에 불과하다
1. 뮤텍스를 사용한다.
     - 뮤텍스란, 스레드 환경에서 자원에 대해 접근을 제한을 강제하는 매커니즘으로, 락이라고도 불린다.
     - 이 경우, 이발사와 손님, 또는 또 한명의 손님중 한명씩만 자신의 상태를 변경할 수 있게 된다.
     - 상태가 변경된 이후엔 뮤텍스를 반납하게된다.
2. 세마포어를 사용한다.
     - 세마포어란 뮤텍스와 유사하게 공유자원에 대해 접근을 제어하는 방법이다
     - 단, 뮤텍스(락)은 오직 1의 프로세스에 대해 접근하므로 상호배제를 위해 사용하지만, 세마포어는 세마포어의 변수만큼 프로세스나 쓰레드가 접근할 수 있어 동기화를 위한 도구로 사용된다.

## 출처
- https://blog.naver.com/hirit808/221790851401
- https://ko.wikipedia.org/wiki/%EC%9E%A0%EC%9E%90%EB%8A%94_%EC%9D%B4%EB%B0%9C%EC%82%AC_%EB%AC%B8%EC%A0%9C