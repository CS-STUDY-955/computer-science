# DB 파티셔닝(Partitioning)
## 개요
- VLDB(Very Large DBMS)같은 하나의 커다란 테이블은 용량이 너무 커서 용량과 성능 측면에서 많은 이슈가 발생한다.
- 이를 여러 부분으로 분할 하는 것으로 이러한 이슈들을 해소할 수 있음

### 장점
- 특정 Query의 성능을 향상
- 대용량 write를 효율적으로 할 수 있음
- 필요한 데이터만 빠르게 조회 가능
- Full scan시 데이터 접근 범위를 줄여 성능을 향상
- 필요한 테이블에만 접근할 수 있으므로 병렬성 증가
- 물리적으로 나뉘었기 때문에 전체 데이터의 훼손 가능성이 감소함
- 파티션 별로 독립적으로 백업 및 복구 가능
- Disk I/O를 분산하므로 Update 성능 향상
- 큰 테이블들이 제거되어 관리가 쉬워짐

### 단점
- table간 join 비용 증가
- 파티셔닝시에 table과 index를 같이 파티셔닝해야만 함

## 파티셔닝의 종류
### 수평 파티셔닝(horizontal partitioning)
- 스키마를 복제한 후, 샤드키를 기준으로 데이터를 나누는 방식
- 예를 들어, index를 기준으로 0~9999번을 하나의 테이블에, 10000~19999번은 또 다른 테이블에 담는 방식을 생각해볼 수 있음
- 또는 사는 지역이 같은 정보를 묶어 하나의 테이블로 만들 수도 있음
- 장점
  - 데이터의 갯수가 적어지므로, 성능이 향상된다
- 단점
  - 데이터를 찾는 과정이 복잡해지므로, 응답시간(latency)은 증가한다.

### 샤딩 (Sharding)
- 수평 파티셔닝한 테이블을 별도의 데이터베이스에 저장하는 방식
- 주로 분산 데이터베이스 시스템에서 사용하는 용어
- 하나의 서버가 고장나면 데이터의 무결성이 깨질 수 있다.

### 수직 파티셔닝(Vertical partitioning)
- 테이블의 일부 열을 다른 테이블로 분리하는 방식
- 이미 정규화된 데이터를 분리한다는 점에서 정규화와 차이가 있다
- 장점
  - 자주 사용하는 컬럼을 분리할 경우, 성능을 향상시킬 수 있다.
  - select 문의 실행시 불필요한 컬럼까지 받아오면 기존에 비해 메모리 소모량이 감소한다.
  - 데이터의 압축률을 높일 수 있다.
- 단점
  - 유지보수가 어려워짐
  - 전체 데이터를 조회시엔 작업이 복잡해지고, latency가 증가함

## 파티셔닝의 분할 기준
### 범위 분할(range partitioning)
- 특정 컬럼의 정렬된 값을 기준으로 분할하는 방식
- 관리가 용이하며, 이력데이터에 적합함
- 범위 안에 포함되는 데이터의 양이 일정하지 않다면, 특정 파티션에 데이터가 편중될 수 있음

### 해시 분할(hash partitioning)
- 파티션 키를 해시시켜서 그 결과로 레코드를 나누는 방식
- null값은 첫번쨰 파티션에 위치함
- 데이터 분포가 고른 컬럼을 기준으로 해야 효과적
- 사용자가 매핑을 제어할 수 없음

### 목록 분할(list partitioning)
- 고정된 키 값을 기준으로 데이터를 분할 (예: 국가명)
- 사용자의 명시적 매핑 가능

### 합성 분할(Composition partitioning)
- 위의 3가지 기술을 결합하여 분할하는 것
- 복합적인 성격을 지닌 데이터의 분할에 용이
- 병렬 DML 작업에 적합
- 파티션의 갯수나 너무 많아지고, 인덱스의 경합이 너무 심해지는 단점이 존재

---

## 참고 자료
- https://code-lab1.tistory.com/202
- https://gmlwjd9405.github.io/2018/09/24/db-partitioning.html
- https://coding-factory.tistory.com/840