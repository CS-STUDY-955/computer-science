# 반정규화 (De-Normalization)

## <b>정규화</b>
 + 테이블 간에 중복 데이터를 최소화 하는 것
 + 정규화되면 테이블이 분해되고 이는 데이터 조회(select)시에 조인(join)을 유발하기 때문에 CPU와 메모리를 많이 사용함

> 알고리즘으로 치면 중첩된 for문을 사용하는 것

<br>

***

## <b>반정규화</b>
+ (정규화된)데이터 베이스 시스템의 성능 향상을 위해 데이터의 중복을 허용하여 조인을 최소화하고 성능을 향상시키는 것
+ 데이터의 중복성과 불일치를 초래하여 데이터 무결성 문제를 야기할 수 있다.

<br>

## 1. 반정규화의 적용 경우
1. 다른 테이블과 조인하는 것이 복잡하고 시간이 많이 걸리는 경우
     + 데이터서버가 분리된 분산데이터베이스 등
2. 많은 범위의 데이터를 자주 처리해야 하는 경우
3. 특정 범위의 데이터만 자주 처리하는 경우
4. 요약/집계 정보가 자주 요구되는 경우

<br>

## 2. 반정규화의 적용 방법

### 2-1. 테이블 반정규화

1. 테이블 병합
    + 1:1 관계 테이블 병합
    + 1:N 관계 테이블 병합
    + 슈퍼/서브타입 테이블 병합

> 테이블 통합 <br>
> 검색은 간편하지만 레코드 증가로 인해 처리량 증가 가능성 있음 <br>
> 입력, 수정, 삭제 규칙이 복잡해질 수 있고 제약조건 설계가 어려움

2. 테이블 분할
    + 수직 분할 : 칼럼단위 테이블을 분산처리 하기 위해 테이블을 1:1로 분리하여 성능 향상
    + 수평 분할 : 로우단위로 집중 발생되는 트랜잭션을 분석하여 데이터 접근의 효율성을 높이기 위해 테이블 분할

> 테이블 분할<br>
> 기본키의 유일성 관리가 어려워짐<br>

3. 테이블 추가
    + 중복 테이블 추가 : 다른 업무, 다른 서버인 경우 동일한 테이블 구조를 중복하여 원격 조인 제거
    + 통계 테이블 추가 : SUM, AVG 등을 미리 수행하여 계산해둠
    + 부분 테이블 추가 : 하나의 테이블의 전체 칼럼 중 자주 이용하는 칼럼들을 모아놓은 테이블 추가
    + 이력 테이블 추가 : 이력 테이블 중 마스터 테이블에 존재하는 레코드를 중복시킴

\* 슈퍼-서브 타입 : 상속 관계라고 보면 됨

<br>

### 2-2. 칼럼 반정규화

1. 중복 칼럼 추가 : 조인을 감소시키기 위해 중복된 칼럼 추가
2. 파생 칼럼 추가 : 트랜잭션 처리 시점에 계산에 의해 발생되는 성능 저하를 예방하기 위해 값을 미리 계산해 칼럼에 보관함(Derived Column)
3. PK에 의한 칼럼 추가
4. 이력 테이블 칼럼 추가
5. 응용 시스템 오작동을 위한 칼럼 추가

<br>

### 2-3. 관계 반정규화

1. 중복관계 추가 : 여러 경로를 거쳐 조인이 가능하지만 이 때 발생하는 성능저하를 예방하기 위해 추가적인 관계를 맺는 방법