# DB Transaction

## 개요

- 트랜잭션이란, 데이터베이스의 상태를 변화시키는 하나의 논리적 기능을 수행하기 위한 작업의 단위를 말한다.
- 여기서 상태를 변화시킨다는 것은 SQL의 질의어를 이용하여 데이터베이스에 접근하는 것을 말한다.
- 작업의 단위란, 사람이 정하는 기준에 따라 한꺼번에 모두 수행되어야 하는 일련의 연산을 뜻한다.
- 예를 들어, A가 B에게서 C라는 물건을 살 경우 이하의 작업을 모두 합쳐 하나의 트랜잭션으로 본다.
  1. A의 계좌에서 지불할 대금만큼 돈을 감소시킨다.
  2. B의 계좌에서 지불한 대금만큼 돈을 증가시킨다.
  3. B의 물자현황에서 판매한 갯수만큼 C물건의 수를 감소시킨다.
  4. A의 물자현황에서 구입한 갯수만큼 C물건의 수를 증가시킨다.
- 이 경우, 1~4의 모든 상황이 정상적으로 끝나야 정상적인 거래로 승인(Commit)되고, 거래 중에 오류가 발생했다면 거래를 시작 전으로 되돌려야 함(Rollback).

### Commit과 Rollback

- Commit: 하나의 트랜잭션이 성공적으로 끝나 데이터베이스가 일관성 있는 상태
- RollBack: 트랜잭션의 처리가 비정상적으로 종료되어 트랜잭션의 원자성이 깨진 상태

## 트랜잭션의 특징(ACID)

### Atomicity(원자성)

- 트랜잭션의 연산은 데이터베이스에 모두 반영되거나 아무것도 반영되지 않아야 함
- 시스템에 장애가 발생했더라도 원자성이 깨지면 안되므로, 원래 상태로 복구시키는 기능이 필요

### Consistency(일관성)

- 트랜잭션이 실행을 성공적으로 완료했다면, 일관성 있는 데이터베이스 상태로 변환되어야 함

### Isolation(독립성, 격리성)

- 둘 이상의 트랜잭션이 동시에 병행 실행중이라면, 한 트랜잭션은 다른 트랜잭션의 연산에 끼어들 수 없음
- 단, 격리 수준에 따라 어디까지 허용하는지는 달라짐

### Durability(영구성)

- 트랜잭션이 성공적으로 완료된 후엔, 데이터베이스에 반영된 수행결과가 어떠한 경우에도 손실되어선 안됨
- 시스템에 장애가 발생했더라도 손실되면 안되므로, 원자성과 마찬가지로 원래 상태로 복구시키는 기능이 필요

## 트랜잭션의 상태

![프레젠테이션1](https://user-images.githubusercontent.com/63623597/230893080-3d1623b9-3873-4a5f-a87f-6885fb01a4b0.png)

### 활동(Active)

- 트랜잭션이 수행을 시작하여 현재 수행중인 상태

### 부분 완료(Partially Committed)

- 마지막 연산이 실행된 직후의 상태
- 아직 데이터베이스에 결과가 반영되지는 않음

### 완료(Committed)

- 트랜잭션이 성공적으로 완료된 상태

### 실패(Failed)

- 장애가 발생하여 트랜잭션이 수행이 중단된 상태

### 철회(Aborted)

- Rollback 연산을 실행한 상태

## 트랜잭션의 회복기법

### Redo(재실행)

- 가장 최근에 저장된 데이터베이스 복사본을 가져와 로그를 이용해 복사본이 만들어진 이후에 실행된 모든 변경 연산을 재실행하여 장애 발생직전의 상태로 복구
- 전반적인 손상에 대해 사용

### Undo(취소)

- 로그를 이용해 지금까지 실행된 모든 변경 연산을 취소하여 원래 상태로 복구
- 변경중이었거나, 변경된 내용만 신뢰성을 잃은 경우에 사용

### Log(로그)

- 변경 연산이 실행될 때마다 데이터를 변경하기 이전값과 변경된 이후의 값을 별도의 파일에 기록하는 방법

### Dump(덤프)

- 데이터베이스 전체를 다른 저장 장치에 복사하는 방법

---

## 정보 출처

- https://brunch.co.kr/@skeks463/27
- https://velog.io/@yu-jin-song/DB-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98Transaction
